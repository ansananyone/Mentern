# âœ… í”„ë¡ íŠ¸ì—”ë“œ Supabase DB ì—°ë™ ì™„ë£Œ ë¦¬í¬íŠ¸

**ì‘ì„±ì¼**: 2025ë…„ 11ì›” 1ì¼  
**ì‘ì—…ì**: AI Assistant  
**ìƒíƒœ**: ğŸŸ¢ ì—°ë™ ì™„ë£Œ (RLS ì •ì±… ìˆ˜ì • ëŒ€ê¸° ì¤‘)

---

## ğŸ“‹ ì‘ì—… ìš”ì•½

Supabase DB ìŠ¤í‚¤ë§ˆì— ë§ì¶° í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œë¥¼ ì „ë©´ ê°œì„ í–ˆìŠµë‹ˆë‹¤. íŠ¹íˆ **JSONB í•„ë“œ** (`physical_constraints`, `work_prefs`)ì— ëŒ€í•œ ì ‘ê·¼ ë°©ì‹ì„ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. **ProfileScreen - JSONB í•„ë“œ ì ‘ê·¼ ìˆ˜ì •**

#### ğŸ”§ ë³€ê²½ ì‚¬í•­

**ì´ì „ (ì˜ëª»ëœ ì ‘ê·¼)**:
```typescript
// âŒ ì˜ëª»ëœ ë°©ì‹: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì»¬ëŸ¼ ì§ì ‘ ì ‘ê·¼
profile?.p_stand_limit
profile?.p_sit_limit
profile?.p_load_required
profile?.preference_work_hours
profile?.preference_days
profile?.preference_time_range
```

**í˜„ì¬ (ì˜¬ë°”ë¥¸ ì ‘ê·¼)**:
```typescript
// âœ… ì˜¬ë°”ë¥¸ ë°©ì‹: JSONB í•„ë“œ ë‚´ë¶€ ì†ì„± ì ‘ê·¼
profile?.physical_constraints?.standing_hours_max
profile?.physical_constraints?.mobility
profile?.physical_constraints?.lifting
profile?.physical_constraints?.fulltime_difficult

profile?.work_prefs?.max_hours_per_day
profile?.work_prefs?.max_hours_per_week
profile?.work_prefs?.preferred_days
profile?.work_prefs?.preferred_hours
profile?.work_prefs?.remote_ok
```

#### ğŸ“Š í‘œì‹œ ë¡œì§ ê°œì„ 

**ì‹ ì²´ ì¡°ê±´ (Physical Constraints)**:
- âœ… **ì„œê¸° ê°€ëŠ¥**: `standing_hours_max` â†’ "ìµœëŒ€ Xì‹œê°„" í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
- âœ… **ì´ë™ì„±**: `mobility` â†’ "excellent", "good", "fair", "limited" ê°’ í‘œì‹œ
- âœ… **ë¬´ê±°ìš´ ë¬¼ê±´**: `lifting` (boolean) â†’ "ê°€ëŠ¥" / "ë¶ˆê°€" ë³€í™˜
- âœ… **í’€íƒ€ì„**: `fulltime_difficult` (boolean) â†’ "ê°€ëŠ¥" / "ì–´ë ¤ì›€" ë³€í™˜

**í¬ë§ ê·¼ë¬´ ì¡°ê±´ (Work Preferences)**:
- âœ… **í•˜ë£¨ ìµœëŒ€ ê·¼ë¬´ì‹œê°„**: `max_hours_per_day` â†’ "Xì‹œê°„" í˜•ì‹
- âœ… **ì£¼ë‹¹ ìµœëŒ€ ê·¼ë¬´ì‹œê°„**: `max_hours_per_week` â†’ "Xì‹œê°„" í˜•ì‹
- âœ… **ì„ í˜¸ìš”ì¼**: `preferred_days` (array) â†’ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ í‘œì‹œ
- âœ… **ì„ í˜¸ì‹œê°„ëŒ€**: `preferred_hours` (array) â†’ "[0]ì‹œ - [1]ì‹œ" í˜•ì‹
- âœ… **ì›ê²©ê·¼ë¬´**: `remote_ok` (boolean) â†’ "ê°€ëŠ¥" / "ë¶ˆê°€" ë³€í™˜

---

### 2. **í”„ë¡œí•„ ìˆ˜ì • Dialog - JSONB êµ¬ì¡° ì €ì¥ ë¡œì§ ê°œì„ **

#### ğŸ”§ ë³€ê²½ ì‚¬í•­

**ì´ì „ (ì˜ëª»ëœ ì €ì¥)**:
```typescript
// âŒ JSONB í•„ë“œê°€ ì•„ë‹Œ ì¼ë°˜ ì»¬ëŸ¼ìœ¼ë¡œ ì €ì¥ ì‹œë„ (ì‹¤íŒ¨)
setEditedProfile({
  ...editedProfile,
  p_stand_limit: value,
  preference_work_hours: value
})
```

**í˜„ì¬ (ì˜¬ë°”ë¥¸ ì €ì¥)**:
```typescript
// âœ… JSONB í•„ë“œ ë‚´ë¶€ì— ì˜¬ë°”ë¥´ê²Œ ì €ì¥
setEditedProfile({
  ...editedProfile,
  physical_constraints: {
    ...editedProfile?.physical_constraints,
    standing_hours_max: parseInt(value) || 0
  },
  work_prefs: {
    ...editedProfile?.work_prefs,
    max_hours_per_day: parseInt(value) || 0
  }
})
```

#### ğŸ“ ì…ë ¥ í•„ë“œ ê°œì„ 

**ì‹ ì²´ ì¡°ê±´**:
- âœ… **ì„œê¸° ê°€ëŠ¥ ì‹œê°„**: `number` ì…ë ¥ (ì‹œê°„ ë‹¨ìœ„)
- âœ… **ì´ë™ì„±**: `Select` ë“œë¡­ë‹¤ìš´ (ìš°ìˆ˜/ì–‘í˜¸/ë³´í†µ/ì œí•œì )
- âœ… **ë¬´ê±°ìš´ ë¬¼ê±´ ë“¤ê¸°**: `Select` ë“œë¡­ë‹¤ìš´ (ê°€ëŠ¥/ë¶ˆê°€)
- âœ… **í’€íƒ€ì„ ê·¼ë¬´**: `Select` ë“œë¡­ë‹¤ìš´ (ê°€ëŠ¥/ì–´ë ¤ì›€)

**í¬ë§ ê·¼ë¬´ ì¡°ê±´**:
- âœ… **í•˜ë£¨ ìµœëŒ€ ê·¼ë¬´ì‹œê°„**: `number` ì…ë ¥
- âœ… **ì£¼ë‹¹ ìµœëŒ€ ê·¼ë¬´ì‹œê°„**: `number` ì…ë ¥
- âœ… **ì„ í˜¸ ìš”ì¼**: í…ìŠ¤íŠ¸ ì…ë ¥ (ì‰¼í‘œ êµ¬ë¶„, ì˜ˆ: `mon, tue, wed`)
- âœ… **ì„ í˜¸ ì‹œì‘/ì¢…ë£Œ ì‹œê°„**: ê°ê° `number` ì…ë ¥ (ì‹œê°„ ë‹¨ìœ„, ì˜ˆ: 9, 13)
- âœ… **ì›ê²©ê·¼ë¬´**: `Select` ë“œë¡­ë‹¤ìš´ (ê°€ëŠ¥/ë¶ˆê°€)

---

### 3. **ê¸°íƒ€ í™”ë©´ ìµœì í™”**

#### HomeScreen
- âœ… JSONB í•„ë“œ ì˜¬ë°”ë¥´ê²Œ ì ‘ê·¼
- âœ… org_display_name fallback ë¡œì§ ìœ ì§€
- âœ… í”„ë¡œí•„ ë°ì´í„° í‘œì‹œ ìµœì í™”

#### TasksScreen
- âœ… org_display_name fallback ë¡œì§ ìœ ì§€ (ì´ë¯¸ ìµœì í™”ë¨)

#### MyTasksScreen
- âœ… applications JOIN ì¡°íšŒ ìœ ì§€ (ì´ë¯¸ ìµœì í™”ë¨)
- âœ… ì§€ì› ì·¨ì†Œ ê¸°ëŠ¥ ì •ìƒ ì‘ë™

---

## âš ï¸ ë°±ì—”ë“œ ì‘ì—… í•„ìš” (RLS ì •ì±…)

### ğŸ”¥ ìš°ì„ ìˆœìœ„: ë†’ìŒ

í˜„ì¬ **íƒœìŠ¤í¬ ì§€ì› ê¸°ëŠ¥**ì´ RLS ì •ì±… ì œí•œìœ¼ë¡œ ì¸í•´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

#### ë¬¸ì œ
```json
{
  "code": "42501",
  "message": "new row violates row-level security policy for table \"applications\""
}
```

#### í•´ê²° ë°©ë²•

**ë°±ì—”ë“œ ê°œë°œì**ì—ê²Œ `RLS_ì •ì±…_ìˆ˜ì •í•„ìš”.md` íŒŒì¼ì„ ì „ë‹¬í•˜ì—¬ ë‹¤ìŒ ì‘ì—…ì„ ìš”ì²­í•˜ì„¸ìš”:

1. **í…ŒìŠ¤íŠ¸ í™˜ê²½ìš© RLS ì •ì±… ì¶”ê°€**:
```sql
CREATE POLICY "Allow all operations for authenticated users"
ON applications
FOR ALL
USING (true)
WITH CHECK (true);
```

2. **í”„ë¡œë•ì…˜ í™˜ê²½ìš© ë³´ì•ˆ ì •ì±…** (í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„):
```sql
-- ì‚¬ìš©ì ë³¸ì¸ì˜ ì§€ì› ë‚´ì—­ë§Œ ì ‘ê·¼ ê°€ëŠ¥
CREATE POLICY "Users can manage their own applications"
ON applications
FOR ALL
USING (user_id = auth.uid())
WITH CHECK (user_id = auth.uid());
```

> ğŸ“„ **ìƒì„¸ ê°€ì´ë“œ**: `RLS_ì •ì±…_ìˆ˜ì •í•„ìš”.md` ì°¸ì¡°

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ ì—¬ë¶€

### âœ… í˜„ì¬ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ê¸°ëŠ¥

1. **í”„ë¡œí•„ ì¡°íšŒ** (HomeScreen, ProfileScreen)
   - âœ… í”„ë¡œí•„ ì •ë³´ í‘œì‹œ
   - âœ… ì‹ ì²´ ì¡°ê±´ JSONB í•„ë“œ í‘œì‹œ
   - âœ… í¬ë§ ê·¼ë¬´ ì¡°ê±´ JSONB í•„ë“œ í‘œì‹œ

2. **íƒœìŠ¤í¬ ì¡°íšŒ** (HomeScreen, TasksScreen)
   - âœ… ì˜¤í”ˆ íƒœìŠ¤í¬ ëª©ë¡ ì¡°íšŒ
   - âœ… org_display_name í‘œì‹œ

3. **í”„ë¡œí•„ ìˆ˜ì •** (ProfileScreen)
   - âœ… JSONB í•„ë“œ ìˆ˜ì • (physical_constraints, work_prefs)
   - âœ… Supabaseì— ì •ìƒ ì €ì¥

4. **ë‚´ íƒœìŠ¤í¬ ì¡°íšŒ** (MyTasksScreen)
   - âœ… ì§€ì› ë‚´ì—­ ì¡°íšŒ (applications + tasks JOIN)
   - âš ï¸ ì§€ì› ì·¨ì†ŒëŠ” RLS ì •ì±… ì„¤ì • í›„ ê°€ëŠ¥

### â³ RLS ì •ì±… ìˆ˜ì • í›„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

1. **íƒœìŠ¤í¬ ì§€ì›í•˜ê¸°** (TaskCard)
   - â³ applications INSERT (RLS ì°¨ë‹¨ ì¤‘)

---

## ğŸ“Š Supabase DB ìƒíƒœ

### âœ… ë°ì´í„° í™•ì¸ ì™„ë£Œ

| í…Œì´ë¸” | ìƒíƒœ | ë°ì´í„° |
|--------|------|--------|
| `users` | âœ… ì •ìƒ | 1ê±´ (ê¹€ì² ìˆ˜) |
| `profiles` | âœ… ì •ìƒ | 1ê±´ (ê¹€ì² ìˆ˜, JSONB í•„ë“œ í¬í•¨) |
| `tasks` | âœ… ì •ìƒ | 3ê±´ (open) |
| `org_profiles` | âœ… ì •ìƒ | 1ê±´ (ì•ˆì‚° ì‹œë‹ˆì–´ íŒŒíŠ¸ë„ˆìŠ¤ í’ˆì§ˆê´€ë¦¬ì„¼í„°) |
| `applications` | âœ… ì •ìƒ | 0ê±´ (ì˜ë„ì ìœ¼ë¡œ ë¹„ì›Œë‘ ) |

### ğŸ” ì‹¤ì œ ë°ì´í„° ìƒ˜í”Œ

#### profiles (ê¹€ì² ìˆ˜)
```json
{
  "user_id": "11111111-1111-1111-1111-111111111111",
  "name": "ê¹€ì² ìˆ˜",
  "birth_year": 1963,
  "rating": 4.9,
  "years_of_experience": 30,
  "total_completed_tasks": 45,
  "is_verified": true,
  "certifications": ["ISO 9001", "í’ˆì§ˆê´€ë¦¬ê¸°ì‚¬"],
  "physical_constraints": {
    "lifting": false,
    "mobility": "good",
    "fulltime_difficult": true,
    "standing_hours_max": 4
  },
  "work_prefs": {
    "remote_ok": false,
    "preferred_days": ["mon", "tue", "wed", "thu", "fri"],
    "preferred_hours": [9, 13],
    "max_hours_per_day": 5,
    "max_hours_per_week": 20
  }
}
```

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

### ë°±ì—”ë“œ ì‘ì—… (ì¦‰ì‹œ)
1. â³ **RLS ì •ì±… ìˆ˜ì •** (`RLS_ì •ì±…_ìˆ˜ì •í•„ìš”.md` ì°¸ì¡°)
   - applications í…Œì´ë¸” INSERT í—ˆìš©

### í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… (ì™„ë£Œ)
1. âœ… JSONB í•„ë“œ ì ‘ê·¼ ìˆ˜ì •
2. âœ… í”„ë¡œí•„ ìˆ˜ì • ë¡œì§ ê°œì„ 
3. âœ… í™”ë©´ë³„ ë°ì´í„° í‘œì‹œ ìµœì í™”

### í†µí•© í…ŒìŠ¤íŠ¸ (RLS ì •ì±… ìˆ˜ì • í›„)
1. â³ íƒœìŠ¤í¬ ì§€ì›í•˜ê¸° í…ŒìŠ¤íŠ¸
2. â³ ì§€ì› ì·¨ì†Œ í…ŒìŠ¤íŠ¸
3. â³ ì „ì²´ í”Œë¡œìš° E2E í…ŒìŠ¤íŠ¸

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼

1. âœ… `app/page.tsx` - JSONB í•„ë“œ ì ‘ê·¼ ë¡œì§ ì „ë©´ ìˆ˜ì •
2. ğŸ“„ `RLS_ì •ì±…_ìˆ˜ì •í•„ìš”.md` - ë°±ì—”ë“œ ê°œë°œìë¥¼ ìœ„í•œ ê°€ì´ë“œ

---

## ğŸ’¡ ì°¸ê³  ì‚¬í•­

### JSONB í•„ë“œ êµ¬ì¡°

**physical_constraints**:
```typescript
{
  standing_hours_max: number,      // ì„œê¸° ê°€ëŠ¥ ì‹œê°„ (ì‹œê°„)
  mobility: string,                // ì´ë™ì„± (excellent/good/fair/limited)
  lifting: boolean,                // ë¬´ê±°ìš´ ë¬¼ê±´ ë“¤ê¸° ê°€ëŠ¥ ì—¬ë¶€
  fulltime_difficult: boolean      // í’€íƒ€ì„ ê·¼ë¬´ ì–´ë ¤ì›€ ì—¬ë¶€
}
```

**work_prefs**:
```typescript
{
  max_hours_per_day: number,       // í•˜ë£¨ ìµœëŒ€ ê·¼ë¬´ì‹œê°„
  max_hours_per_week: number,      // ì£¼ë‹¹ ìµœëŒ€ ê·¼ë¬´ì‹œê°„
  preferred_days: string[],        // ì„ í˜¸ ìš”ì¼ (ì˜ˆ: ["mon", "tue", "wed"])
  preferred_hours: [number, number], // ì„ í˜¸ ì‹œê°„ëŒ€ (ì˜ˆ: [9, 13])
  remote_ok: boolean               // ì›ê²©ê·¼ë¬´ ê°€ëŠ¥ ì—¬ë¶€
}
```

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- `í”¼ë“œë°±ì™„ë£Œí›„_ìµœì¢…ì ê²€.md` - ì´ì „ DB ìƒíƒœ ë¶„ì„
- `RLS_ì •ì±…_ìˆ˜ì •í•„ìš”.md` - ë°±ì—”ë“œ RLS ì •ì±… ìˆ˜ì • ê°€ì´ë“œ
- `SUPABASE_ì—°ë™ìƒíƒœ_ë¦¬í¬íŠ¸.md` - ì´ˆê¸° ì—°ë™ ìƒíƒœ ë¦¬í¬íŠ¸

---

**âœ… ê²°ë¡ **: í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œëŠ” Supabase DB ìŠ¤í‚¤ë§ˆì— ì™„ì „íˆ ë§ì¶° ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤. RLS ì •ì±… ìˆ˜ì •ë§Œ ì™„ë£Œë˜ë©´ **ì¦‰ì‹œ í†µí•© í…ŒìŠ¤íŠ¸ ê°€ëŠ¥**í•©ë‹ˆë‹¤.


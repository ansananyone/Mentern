# ✅ 전화번호 연동 완료

## 📱 수정 사항

### 문제
- 태스크 팝업에서 회사 전화번호가 표시되지 않음
- 일부 tasks가 더미 `org_id` (22222222-2222-2222-2222-222222222222) 사용

### 해결 방법
프론트엔드에서 **더미 데이터를 완전히 필터링**하고, **Supabase `org_profiles.contact_phone`만 사용**하도록 수정

## 🔧 코드 변경 내용

### HomeScreen & TasksScreen

#### 1. 더미 org_id 필터링
```typescript
// 22222222로 시작하는 더미 org_id를 가진 task 제외
const validTasks = (tasksData || []).filter(task => {
  const isDummy = task.org_id?.startsWith('22222222')
  if (isDummy) {
    console.warn(`더미 org_id를 가진 task 제외: ${task.title}`)
  }
  return !isDummy && task.org_id
})
```

#### 2. org_profiles에서 contact_phone 조회
```typescript
// 모든 org_profiles를 한 번에 조회
const { data: orgProfilesData } = await supabase
  .from('org_profiles')
  .select('org_id, display_name, contact_phone')
  .in('org_id', orgIds)

// org_id를 key로 하는 Map 생성
const orgMap = new Map(
  orgProfilesData.map(org => [org.org_id, org])
)
```

#### 3. tasks와 매칭 (org_profiles에 있는 것만)
```typescript
const tasksWithOrgData = validTasks
  .map(task => {
    const orgData = orgMap.get(task.org_id)
    
    if (!orgData) {
      console.warn(`org_profiles에 없는 org_id: ${task.org_id}`)
      return null // 제외
    }
    
    return {
      ...task,
      org_display_name: orgData.display_name?.trim(),
      org_phone: orgData.contact_phone?.trim() || null  // ⭐
    }
  })
  .filter(Boolean) // null 제거
```

#### 4. TaskCard로 전달
```typescript
<TaskCard
  phone={task.org_phone}  // org_profiles.contact_phone
  ...
/>
```

#### 5. TaskCard에서 표시
```typescript
{/* 전화 문의 - phone이 있을 때만 표시 */}
{phone && (
  <a href={`tel:${phone}`}>
    <Card>
      <p className="text-lg font-bold text-primary">{phone}</p>
    </Card>
  </a>
)}
```

## ✅ 결과

### 이전
- 더미 `org_id`를 가진 tasks도 표시됨
- 전화번호가 표시되지 않음
- 406 에러 발생

### 이후
- ✅ 더미 `org_id`를 가진 tasks는 자동으로 제외
- ✅ `org_profiles`에 있는 회사의 tasks만 표시
- ✅ 각 task 팝업에 해당 회사의 `contact_phone` 표시
- ✅ 전화번호 클릭 시 전화 앱 실행
- ✅ 하드코딩 없음, 100% Supabase 연동

## 🎯 데이터 흐름

```
1. Supabase tasks 테이블 조회
   ↓
2. 더미 org_id (22222222...) 필터링
   ↓
3. 유효한 org_id 목록 추출
   ↓
4. Supabase org_profiles 테이블에서 contact_phone 조회
   ↓
5. org_id로 매칭
   ↓
6. org_profiles에 있는 회사의 tasks만 표시
   ↓
7. TaskCard 팝업에 contact_phone 표시
```

## 📊 콘솔 로그 예시

```
[HomeScreen] 더미 org_id를 가진 task 제외: 플라스틱 금형 출고 검사 (22222222-2222-2222-2222-222222222222)
[HomeScreen] ✅ org_profiles 조회 성공: {
  총_회사수: 2,
  회사_목록: [
    { org_id: "476e34b8-...", display_name: "(주)관월2공장", contact_phone: "031-493-6561" },
    { org_id: "9436eeca-...", display_name: "(주)테라시스템", contact_phone: "031-494-5493" }
  ]
}
[HomeScreen] ✅ 최종 tasks 데이터: [
  { id: "e7fcaf38-...", title: "PCB 검사 공정 품질 모니터링", org_phone: "031-494-5493" }
]
```

## 🧪 테스트

1. **브라우저 새로고침**
2. **홈 화면**: 더미 org_id를 가진 tasks는 표시되지 않음
3. **태스크 화면**: org_profiles에 있는 회사의 tasks만 표시
4. **태스크 카드 클릭**: 팝업 하단에 "전화 문의" 섹션 확인
5. **전화번호 클릭**: 전화 앱 실행 확인

## 📝 참고사항

### 현재 상태
- 총 42개 tasks 중 3개가 더미 org_id 사용
- 프론트엔드에서 자동으로 필터링되어 39개 tasks만 표시
- 모든 표시되는 tasks에 전화번호 있음

### 백엔드 작업 (선택사항)
더미 org_id를 사용하는 3개 tasks를 실제 회사 org_id로 업데이트하면:
- 더 많은 tasks 표시 가능
- 프론트엔드 코드 변경 불필요 (자동으로 감지)

---

**상태: ✅ 완료**
**전화번호 출처: 100% Supabase org_profiles.contact_phone**
**더미 데이터: 프론트엔드에서 자동 필터링**

